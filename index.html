<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frame Selector</title>

<style>
  body {
    margin: 0;
    background: #eee;
    display: flex;
    justify-content: center;
    padding: 20px;
    font-family: Arial, sans-serif;
  }

  .wrapper {
    position: relative;
    text-align: center;
  }

  canvas {
    display: block;
    margin: auto;
    background: white;
    border-radius: 12px;
  }

  /* upload buttons centered inside frame */
  #buttonRow {
    position: absolute;
    top: 0;
    left: 0;
    transform: translate(-50%, -50%);
    z-index: 10;
    background: rgba(255, 255, 255, 0.85);
    padding: 12px;
    border-radius: 12px;
    display: flex;
    gap: 6px;
  }

  /* hidden by default */
  #downloadBtn {
    display: none;
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 18px;
    border: none;
    background: black;
    color: white;
    border-radius: 8px;
    cursor: pointer;
  }
</style>
</head>

<body>

<div class="wrapper">
  <canvas id="canvas"></canvas>

  <!-- Upload buttons (inside frame center) -->
  <div id="buttonRow">
    <button onclick="uploadImage()">Upload Image</button>
  </div>

  <!-- Download button (below poster) -->
  <button id="downloadBtn" onclick="downloadImage()">Download</button>
</div>

<input type="file" id="imageUpload" accept="image/*" style="display:none">

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const poster = new Image();
poster.src = "poster.png";  // your poster

let frame = { x: 550, y: 780, r: 350 }; // adjust for your poster
let scaleFactor = 1;

let uploadedImg = null;

/* Load poster first */
poster.onload = () => {
  const w = poster.width;
  const h = poster.height;

  scaleFactor = Math.min(window.innerWidth * 0.95 / w, 1);
  canvas.width = w * scaleFactor;
  canvas.height = h * scaleFactor;

  frame.x *= scaleFactor;
  frame.y *= scaleFactor;
  frame.r *= scaleFactor;

  // Center buttonRow inside circle frame
  const buttonRow = document.getElementById("buttonRow");
  buttonRow.style.left = frame.x + "px";
  buttonRow.style.top = frame.y + "px";

  draw();
};

/* Draw poster + image in circle */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.drawImage(poster, 0, 0, canvas.width, canvas.height);

  if (uploadedImg) {
    ctx.save();
    ctx.beginPath();
    ctx.arc(frame.x, frame.y, frame.r, 0, Math.PI * 2);
    ctx.clip();

    ctx.drawImage(
      uploadedImg,
      frame.x - frame.r,
      frame.y - frame.r,
      frame.r * 2,
      frame.r * 2
    );

    ctx.restore();
  }

  // Draw circle outline
  ctx.beginPath();
  ctx.arc(frame.x, frame.y, frame.r, 0, Math.PI * 2);
  ctx.lineWidth = 8;
  ctx.strokeStyle = "white";
  ctx.stroke();
}

/* Image upload trigger */
function uploadImage() {
  document.getElementById("imageUpload").click();
}

/* After selecting an image */
document.getElementById("imageUpload").addEventListener("change", function (e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();

  reader.onload = function (event) {
    uploadedImg = new Image();
    uploadedImg.onload = () => {
      draw();

      // hide button row after uploading
      document.getElementById("buttonRow").style.display = "none";

      // show download button
      document.getElementById("downloadBtn").style.display = "inline-block";
    };
    uploadedImg.src = event.target.result;
  };

  reader.readAsDataURL(file);
});

/* Download final poster */
function downloadImage() {
  const link = document.createElement("a");
  link.download = "framed_image.png";
  link.href = canvas.toDataURL();
  link.click();
}
</script>

</body>
</html>
